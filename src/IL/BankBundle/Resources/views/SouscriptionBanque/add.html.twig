{% extends "ILBankBundle::layout.html.twig" %}
{% block title %}Nouvelle  souscription {% endblock %}

{% block breadcrumb %}
    <div class="breadcrumbs">
        <div class="col-sm-4">
            <div class="page-header float-left">
                <div class="page-title">
                    <h1>Souscription Banque</h1>
                </div>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="page-header float-right">
                <div class="page-title">
                    <ol class="breadcrumb text-right">
                        <li><a href="{{ path('il_bank_homepage') }}">Tableau de Bord</a></li>
                        <li><a href="{{ path('il_bank_souscription_mobile_list') }}">Souscription Banque</a></li>
                        <li class="active">Nouvelle souscription</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block content %}
    {{ form_start(form) }}

    {# Les erreurs générales du formulaire. #}
    {{ form_errors(form) }}
    <div class="container-fluid">
    <div class="animated fadeIn">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <strong>Fiche d'enregistrement de liaison de banque=>carte</strong>
                        <small>Remplissez ce champ pour souscrire à ILAFIA</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-7">
                                <div class="form-group">
                                    <label for="nom_carte">Numero de la carte prepayée *</label>
                                    {{ form_widget(form.numeroCarte, {'attr': {'class': 'form-control ', 'minlength': '16', 'maxlength': '16', 'onkeypress': 'return onlyNos(event,this);',  'placeholder': 'Ex. 5439867786767676' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Type de carte</label>
                                    {{ form_widget(form.typeCarte, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'readonly':'readonly', 'placeholder': '' }}) }}
                                </div>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <label for="nom_carte">Mois d'expiration *</label>
                                        {{ form_widget(form.moisExpiration, {'attr': {'class': 'form-control ', 'maxlength': '2', 'id': 'nom_carte', 'placeholder': '' }}) }}
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="nom_carte">Année d'expiration *</label>
                                        {{ form_widget(form.anneeExpiration, {'attr': {'class': 'form-control ', 'maxlength': '4', 'id': 'nom_carte', 'placeholder': '' }}) }}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Statut carte</label>
                                    {{ form_widget(form.statutCarte, {'attr': {'class': 'form-control ', 'readonly':'readonly', 'value': 'Activated', 'placeholder': '' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Statut de Liaison</label>
                                    {{ form_widget(form.statutLiaison, {'attr': {'class': 'form-control ', 'readonly':'readonly', 'value': 'Pending', 'id': 'nom_carte', 'placeholder': '' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Numero de téléphone *</label>
                                                                        {{ form_widget(form.numeroTelephone, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'maxlength': '8',  'minlength': '8', 'onkeypress': 'return onlyNos(event,this);', 'placeholder': '' }}) }}

                                </div>
                            </div>
                            <div class="col-md-5">
                             <div class="form-group">
                                    <label for="nom_carte">Numéro de compte *</label>
                                    {{ form_widget(form.numeroCompte, {'attr': {'class': 'form-control ', 'size': '16', 'minlength' : '16', 'maxlength': '16', 'onkeypress': 'return onlyNos(event,this);',  'placeholder': 'Ex. 9778675746796987' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Type de compte *</label>
                                    {{ form_widget(form.typeCompte, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'readonly':'readonly', 'placeholder': '' }}) }}
                                </div>

                                <div class="form-group">
                                    <label for="nom_carte">Nom sur la carte *</label>
                                    {{ form_widget(form.nomCarte, {'attr': {'class': 'form-control ', 'onkeypress': 'return onlyAlphabets(event,this);', 'placeholder': 'Ex. Cheick Oumar' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Label de la carte *</label>
                                    {{ form_widget(form.labelCompte, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': 'Ex. Cheick Oumar' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Alias du compte *</label>
                                    {{ form_widget(form.aliasCompte, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'readonly':'readonly', 'minlength' : '12', 'maxlength': '12', 'placeholder': 'Ex. 512420181010' }}) }}
                                </div>
                                <div class="form-group">
                                    <label for="nom_carte">Raison</label>
                                    {{ form_widget(form.raison, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': 'Un commentaire ici ...' }}) }}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                {{ form_widget(form.c2cb, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': '', 'required': 'required' }}) }} CB2C
                            </div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <div class="form-group">
                                {{ form_widget(form.cb2c, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': '', 'required': 'required' }}) }} C2CB
                            </div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <div class="form-group">
                                {{ form_widget(form.balanceInquery, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': '' }}) }} Balance Inquery
                            </div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <div class="form-group">
                                {{ form_widget(form.miniStatement, {'attr': {'class': 'form-control ', 'id': 'nom_carte', 'placeholder': '' }}) }} Mini statement
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">

                        <button type="submit" class="btn btn-sm btn-primary">
                            <i class="fa fa-dot-circle-o"></i> Enregistrer</button>
                        <button type="reset" class="btn btn-sm btn-danger">
                            <i class="fa fa-ban"></i> Reset</button>
                    </div>

                </div>

            </div>
        </div>
    </div>

    {{ form_rest(form) }}

    {# Fermeture de la balise <form> du formulaire HTML #}
    {{ form_end(form) }}

{% endblock %}

{% block scripts %}
        <script language="Javascript" type="text/javascript">



        function onlyAlphabets(e, t) {

            try {

                if (window.event) {

                    var charCode = window.event.keyCode;

                }

                else if (e) {

                    var charCode = e.which;

                }

                else { return true; }

                if ((charCode > 64 && charCode < 91) || (charCode > 96 && charCode < 123 || charCode == 32))

                    return true;

                else

                    return false;

            }

            catch (err) {

                alert(err.Description);

            }

        }

        function onlyNos(e, t) {

            try {

                if (window.event) {

                    var charCode = window.event.keyCode;

                }

                else if (e) {

                    var charCode = e.which;

                }

                else { return true; }

                if (charCode > 31 && (charCode < 48 || charCode > 57 )) {

                    return false;

                }

                return true;

            }

            catch (err) {

                alert(err.Description);

            }

        }

        jQuery(function($) {

            /**
             * Checks if the date is OK
            */
            var checkDate = function (){
                
                today = (new Date()).getTime()
                year = $('#il_corebundle_souscriptionbanque_anneeExpiration').val()
                month = $('#il_corebundle_souscriptionbanque_moisExpiration').val()
                _date = (new Date(year + '-' + month + '-' + 28))

                if( _date <= today){
                    alert("Date d'expiration doit être dans le future");
                    $(':input[type="submit"]').prop('disabled', true);
                    $("#il_corebundle_souscriptionbanque_moisExpiration").css("border-color", "red");
                    $("#il_corebundle_souscriptionbanque_anneeExpiration").css("border-color", "red");
                    console.log((new Date().getMonth()));
                }else{
                    $(':input[type="submit"]').prop('disabled', false);
                    $("#il_corebundle_souscriptionbanque_moisExpiration").css("border-color", "#ced4da");
                    $("#il_corebundle_souscriptionbanque_anneeExpiration").css("border-color", "#ced4da");
                }
            }

            /*
            if($('#il_corebundle_souscriptionbanque_anneeExpiration').val() == (new Date()).getFullYear() && $('#il_corebundle_souscriptionbanque_moisExpiration').val() < (new Date().getMonth())){
                $(':input[type="submit"]').prop('disabled', true);
                $("#il_corebundle_souscriptionbanque_moisExpiration").css("border-color", "red");
                console.log((new Date().getMonth()));
            }else{
                $(':input[type="submit"]').prop('disabled', false);
                $("#il_corebundle_souscriptionbanque_moisExpiration").css("border-color", "none");
            }*/

           $("#il_corebundle_souscriptionbanque_moisExpiration").change(function() {
                checkDate()
            });

           $("#il_corebundle_souscriptionbanque_anneeExpiration").change(function() {
                checkDate()
            });

            $( "#il_corebundle_souscriptionbanque_numeroCarte" ).change(function() {
                var numeroCarte = $('#il_corebundle_souscriptionbanque_numeroCarte').val();

             console.log(numeroCarte.substring(0, 3) );

            if(numeroCarte.substring(0, 1) == '3')
                $('#il_corebundle_souscriptionbanque_typeCarte').val('AMEX');
            else if(numeroCarte.substring(0, 1) == '4')
                 $('#il_corebundle_souscriptionbanque_typeCarte').val('VISA');
            else if(numeroCarte.substring(0, 1) == '5')
                 $('#il_corebundle_souscriptionbanque_typeCarte').val('MASTERCARD');
            else
                 $('#il_corebundle_souscriptionbanque_typeCarte').val('UNKNOWN');
              });

            $( "#il_corebundle_souscriptionbanque_numeroCompte" ).change(function() {
                 var numeroCompte = $('#il_corebundle_souscriptionbanque_numeroCompte').val();

                 if(numeroCompte.substring(0, 3) == '123')
                     $('#il_corebundle_souscriptionbanque_typeCompte').val('EPARGNE');
                 else
                     $('#il_corebundle_souscriptionbanque_typeCompte').val('COURANT');
            })
        });

    </script>
{% endblock %}